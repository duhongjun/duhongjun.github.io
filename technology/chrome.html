<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>浏览器工作原理与实践 | 菜鸡互啄</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.4.0">
    <link rel="icon" href="/img/logo.jpeg">
    
    <link rel="preload" href="/assets/css/0.styles.301134c6.css" as="style"><link rel="preload" href="/assets/js/app.102dff93.js" as="script"><link rel="preload" href="/assets/js/7.84e4d051.js" as="script"><link rel="preload" href="/assets/js/1.c52b9357.js" as="script"><link rel="preload" href="/assets/js/41.6a8fcc74.js" as="script"><link rel="prefetch" href="/assets/js/10.258f5228.js"><link rel="prefetch" href="/assets/js/11.333e4c1b.js"><link rel="prefetch" href="/assets/js/12.6b136b8d.js"><link rel="prefetch" href="/assets/js/13.0ceb6003.js"><link rel="prefetch" href="/assets/js/14.59eafbbf.js"><link rel="prefetch" href="/assets/js/15.74c13902.js"><link rel="prefetch" href="/assets/js/16.5c8cd82b.js"><link rel="prefetch" href="/assets/js/17.bc01db77.js"><link rel="prefetch" href="/assets/js/18.b74c8dd8.js"><link rel="prefetch" href="/assets/js/19.075d3808.js"><link rel="prefetch" href="/assets/js/20.a012f7f2.js"><link rel="prefetch" href="/assets/js/21.93f4dffc.js"><link rel="prefetch" href="/assets/js/22.b12f186b.js"><link rel="prefetch" href="/assets/js/23.1f3012a3.js"><link rel="prefetch" href="/assets/js/24.5dc7cb9c.js"><link rel="prefetch" href="/assets/js/25.32be55b3.js"><link rel="prefetch" href="/assets/js/26.eedbed54.js"><link rel="prefetch" href="/assets/js/27.812d9cc1.js"><link rel="prefetch" href="/assets/js/28.dbdd419a.js"><link rel="prefetch" href="/assets/js/29.e33ee31f.js"><link rel="prefetch" href="/assets/js/30.9c4fd43a.js"><link rel="prefetch" href="/assets/js/31.6353058b.js"><link rel="prefetch" href="/assets/js/32.ca25b50f.js"><link rel="prefetch" href="/assets/js/33.0b6df38d.js"><link rel="prefetch" href="/assets/js/34.fb5e81a7.js"><link rel="prefetch" href="/assets/js/35.b8aa0e75.js"><link rel="prefetch" href="/assets/js/36.5ef8c43c.js"><link rel="prefetch" href="/assets/js/37.e077e110.js"><link rel="prefetch" href="/assets/js/38.622e3469.js"><link rel="prefetch" href="/assets/js/39.ca3c1a8c.js"><link rel="prefetch" href="/assets/js/4.e3ec3e7f.js"><link rel="prefetch" href="/assets/js/40.a8472019.js"><link rel="prefetch" href="/assets/js/42.fcdf3c13.js"><link rel="prefetch" href="/assets/js/43.82cdd117.js"><link rel="prefetch" href="/assets/js/44.dc4dfda7.js"><link rel="prefetch" href="/assets/js/45.a2b185ce.js"><link rel="prefetch" href="/assets/js/46.e9aeeab1.js"><link rel="prefetch" href="/assets/js/47.712ddb2e.js"><link rel="prefetch" href="/assets/js/5.7adad2e0.js"><link rel="prefetch" href="/assets/js/6.5dda432f.js"><link rel="prefetch" href="/assets/js/8.5aa2fe84.js"><link rel="prefetch" href="/assets/js/9.3f9bfda6.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.eab56a23.js">
    <link rel="stylesheet" href="/assets/css/0.styles.301134c6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.jpeg" alt="菜鸡互啄" class="logo"> <span class="site-name can-hide">菜鸡互啄</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/timeLine/" class="nav-link">首页</a></div><div class="nav-item"><a href="/technology/" class="nav-link router-link-active">技术</a></div><div class="nav-item"><a href="/project/" class="nav-link">工程化</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="/tags/" class="nav-link">标签库</a></div><div class="nav-item"><a href="/gossip/" class="nav-link">杂谈</a></div><div class="nav-item"><a href="/message/" class="nav-link">留言板</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">链接</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/duhongjun" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/timeLine/" class="nav-link">首页</a></div><div class="nav-item"><a href="/technology/" class="nav-link router-link-active">技术</a></div><div class="nav-item"><a href="/project/" class="nav-link">工程化</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="/tags/" class="nav-link">标签库</a></div><div class="nav-item"><a href="/gossip/" class="nav-link">杂谈</a></div><div class="nav-item"><a href="/message/" class="nav-link">留言板</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">链接</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/duhongjun" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>浏览器工作原理与实践</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/technology/chrome.html#_1-宏观视角下的浏览器" class="sidebar-link">1. 宏观视角下的浏览器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/technology/chrome.html#chrome-架构" class="sidebar-link">Chrome 架构</a></li></ul></li><li><a href="/technology/chrome.html#_2-浏览器中的javascript执行机制" class="sidebar-link">2. 浏览器中的JavaScript执行机制</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/technology/chrome.html#_3-v8工作原理" class="sidebar-link">3. V8工作原理</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/technology/chrome.html#_4-浏览器中的页面事件循环系统" class="sidebar-link">4. 浏览器中的页面事件循环系统</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/technology/chrome.html#_5-浏览器中的页面" class="sidebar-link">5. 浏览器中的页面</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/technology/chrome.html#_6-浏览器中的网络" class="sidebar-link">6. 浏览器中的网络</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/technology/chrome.html#_7-浏览器安全" class="sidebar-link">7. 浏览器安全</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content__default"><blockquote><p>Tips: 学习资料来自极客时间 <a href="https://time.geekbang.org/column/article/113513" target="_blank" rel="noopener noreferrer">浏览器工作原理与实践-李兵<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <h2 id="_1-宏观视角下的浏览器"><a href="#_1-宏观视角下的浏览器" class="header-anchor">#</a> 1. 宏观视角下的浏览器</h2> <h3 id="chrome-架构"><a href="#chrome-架构" class="header-anchor">#</a> Chrome 架构</h3> <p><code>Chrome</code> 使用了多进程来并行处理任务，我们打开一个页面时，可以通过任务管理器看到，有4个进程。 我们先来了解下 <code>线程</code>、<code>进程</code> 和 <code>并行处理</code>的概念。</p> <h4 id="什么是并行处理"><a href="#什么是并行处理" class="header-anchor">#</a> 什么是并行处理</h4> <p>计算机中的并行处理就是同一时刻处理多个任务, 假如我们有个任务是计算下面几个表达式的值，并显示出最后的结果：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token constant">A</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">+</span><span class="token number">2</span>
<span class="token constant">B</span> <span class="token operator">=</span> <span class="token number">20</span><span class="token operator">/</span><span class="token number">5</span>
<span class="token constant">C</span> <span class="token operator">=</span> <span class="token number">7</span><span class="token operator">*</span><span class="token number">8</span>
</code></pre></div><p>我们可以把这个过程拆分为四个任务： 三次计算和显示最后的结果。</p> <ul><li>如果是单线程处理，就是按这四步的顺序依次分别执行这四个任务；</li> <li>如果采用多线程，我们只需要分两步：1，使用三个线程同时执行前三个计算任务；2，执行最后的显示任务</li></ul> <p>通过对比发现，使用并行处理可以大大提升性能！</p> <h4 id="线程-vs-进程"><a href="#线程-vs-进程" class="header-anchor">#</a> 线程 VS 进程</h4> <p>上面提到，多线程可以并行处理任务。但是<strong>线程是不能单独存在的，它是由进程来启动和管理的。</strong></p> <p>什么是进程？</p> <p><strong>一个进程就是一个程序的运行实例</strong>。详细解释就是，启动一个程序的时候，操作系统会为该程序创建一块内存，
用来存放代码、运行中的数据和一个执行任务的主线程，我们把这样的一个运行环境叫<strong>进程</strong>。</p> <p>刚才的例子如下图：
<img src="https://static001.geekbang.org/resource/image/33/da/3380f0a16c323deda5d3a300804b95da.png" alt=""></p> <p>可以看出，<strong>线程是依附于进程的，而进程中使用多线程并行处理能提升运算效率。</strong></p> <h4 id="进程和线程之间的关系有以下-4-个特点："><a href="#进程和线程之间的关系有以下-4-个特点：" class="header-anchor">#</a> 进程和线程之间的关系有以下 4 个特点：</h4> <ul><li><ol><li>进程中的任意一线程执行出错，都会导致整个进程的崩溃。</li></ol></li> <li><ol start="2"><li>线程之间共享进程中的数据。</li></ol></li> <li><ol start="3"><li>当一个进程关闭之后，操作系统会回收进程所占用的内存。</li></ol></li> <li><ol start="4"><li>进程之间的内容相互隔离。</li></ol></li></ul> <h4 id="单进程浏览器时代"><a href="#单进程浏览器时代" class="header-anchor">#</a> 单进程浏览器时代</h4> <p><strong>单进程浏览器是指浏览器的所有功能模块都是运行在同一个进程里</strong>，这些模块包含了网络、插件、JavaScript 运行环境、渲染引擎和页面等。</p> <p>如此多的功能模块运行在一个进程里，导致了以下三个问题：</p> <ul><li>问题 1：不稳定：插件或者渲染引擎模块是不稳定的，可能导致浏览器崩溃。</li> <li>问题 2：不流畅：运行在同一个线程中，就意味着同一时刻只能有一个模块可以执行，<strong>内存泄漏</strong>也是单进程变慢的重要原因。</li> <li>问题 3：不安全：恶意插件、恶意脚本获取系统权限和资源，很危险。</li></ul> <h4 id="多进程浏览器时代"><a href="#多进程浏览器时代" class="header-anchor">#</a> 多进程浏览器时代</h4> <p>早期的 <code>Chrome</code> 多进程架构如下：
<img src="https://static001.geekbang.org/resource/image/cd/60/cdc9215e6c6377fc965b7fac8c3ec960.png" alt=""></p> <ul><li>进程间相互隔离，不会影响到浏览器或者其他页面， 解决了不稳定的问题。</li> <li>JS 运行在渲染进程中，至多只会影响自己这个页面；对于内存泄漏，当关闭一个页面时，该进程占用的内存都会被系统回收。</li> <li>Chrome 把插件进程和渲染进程锁在沙箱里面，恶意程序无法突破沙箱去获取系统权限。</li></ul> <p>最新的 <code>Chrome</code> 进程架构如下：
<img src="https://static001.geekbang.org/resource/image/b6/fc/b61cab529fa31301bde290813b4587fc.png" alt=""></p> <p>从图中可以看到，最新的 Chrome 浏览器包括：1 个浏览器（Browser）主进程、1 个 GPU 进程、1 个网络（NetWork）进程、多个渲染进程和多个插件进程。</p> <p>逐个介绍下这几个进程的功能:</p> <ul><li><strong>浏览器进程</strong>。主要负责界面显示、用户交互、子进程管理，同时提供存储等功能。</li> <li><strong>渲染进程</strong>。核心任务是将 HTML、CSS 和 JavaScript 转换为用户可以与之交互的网页，排版引擎 Blink 和 JavaScript 引擎 V8 都是运行在该进程中，默认情况下，Chrome 会为每个 Tab 标签创建一个渲染进程。出于安全考虑，渲染进程都是运行在沙箱模式下。</li> <li><strong>GPU 进程</strong>。其实，Chrome 刚开始发布的时候是没有 GPU 进程的。而 GPU 的使用初衷是为了实现 3D CSS 的效果，只是随后网页、Chrome 的 UI 界面都选择采用 GPU 来绘制，这使得 GPU 成为浏览器普遍的需求。最后，Chrome 在其多进程架构上也引入了 GPU 进程。</li> <li><strong>网络进程</strong>。主要负责页面的网络资源加载，之前是作为一个模块运行在浏览器进程里面的，直至最近才独立出来，成为一个单独的进程。</li> <li><strong>插件进程</strong>。主要是负责插件的运行，因插件易崩溃，所以需要通过插件进程来隔离，以保证插件进程崩溃不会对浏览器和页面造成影响。</li></ul> <p>现在我们明白了为什么开头说打开一个网页有4个进程了，如果有插件运行的话，还要再加上一个插件进程~</p> <p>不过凡事都有两面性，多进程模型也有它自己的问题：</p> <ul><li><strong>更高的资源占用</strong>：每个进程都会包含公共基础结构的副本（如 JavaScript 运行环境），这就意味着浏览器会消耗更多的内存资源。</li> <li><strong>更复杂的体系架构</strong>：浏览器各模块之间耦合性高、扩展性差等问题，会导致现在的架构已经很难适应新的需求了。</li></ul> <h4 id="未来面向服务的架构"><a href="#未来面向服务的架构" class="header-anchor">#</a> 未来面向服务的架构</h4> <p>为了解决这些问题，在 2016 年，Chrome 官方团队使用“面向服务的架构”的思想设计了新的 Chrome 架构。
原来的各种模块会被重构成独立的服务（Service），每个服务（Service）都可以在独立的进程中运行，访问服务（Service）必须使用定义好的接口，通过 IPC 来通信，从而<strong>构建一个更内聚、松耦合、易于维护和扩展的系统</strong>。</p> <p>下面是“面向服务的架构”的进程模型图：
<img src="https://static001.geekbang.org/resource/image/32/2a/329658fe821252db47b0964037a1de2a.png" alt=""></p> <p>同时 Chrome 还提供灵活的弹性架构，在强大性能设备上会以多进程的方式运行基础服务，但是如果在资源受限的设备上（如下图），Chrome 会将很多服务整合到一个进程中，从而节省内存占用。
<img src="https://static001.geekbang.org/resource/image/a9/76/a9ba86d7b03263fa3997d3733d958176.png" alt=""></p> <p>目前 Chrome 正处在老的架构向服务化架构过渡阶段，这将是一个漫长的迭代过程~</p> <br> <h2 id="_2-浏览器中的javascript执行机制"><a href="#_2-浏览器中的javascript执行机制" class="header-anchor">#</a> 2. 浏览器中的JavaScript执行机制</h2> <br> <h2 id="_3-v8工作原理"><a href="#_3-v8工作原理" class="header-anchor">#</a> 3. V8工作原理</h2> <br> <h2 id="_4-浏览器中的页面事件循环系统"><a href="#_4-浏览器中的页面事件循环系统" class="header-anchor">#</a> 4. 浏览器中的页面事件循环系统</h2> <br> <h2 id="_5-浏览器中的页面"><a href="#_5-浏览器中的页面" class="header-anchor">#</a> 5. 浏览器中的页面</h2> <br> <h2 id="_6-浏览器中的网络"><a href="#_6-浏览器中的网络" class="header-anchor">#</a> 6. 浏览器中的网络</h2> <br> <h2 id="_7-浏览器安全"><a href="#_7-浏览器安全" class="header-anchor">#</a> 7. 浏览器安全</h2></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">7/28/2020, 7:12:29 PM</span></div></div> <!----> </div> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.102dff93.js" defer></script><script src="/assets/js/7.84e4d051.js" defer></script><script src="/assets/js/1.c52b9357.js" defer></script><script src="/assets/js/41.6a8fcc74.js" defer></script>
  </body>
</html>
